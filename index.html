<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voice AI Assistant - Powered by THE ENTITY</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Light theme inspired by THE ENTITY logo */
      --bg-primary: #FAFBFF;
      --bg-secondary: #F5F7FE;
      --bg-card: #FFFFFF;
      --text-primary: #1a1a2e;
      --text-secondary: #6B7280;
      --text-muted: #9CA3AF;
      
      /* Gradient colors from logo */
      --blue-light: #A8D5FF;
      --purple-light: #C4B5FD;
      --pink-light: #F0ABFC;
      --coral: #FCA5A5;
      --yellow: #FCD34D;
      
      /* Secondary gradient */
      --blue-accent: #93C5FD;
      --purple-accent: #DDD6FE;
      --pink-accent: #FBCFE8;
      
      --border: rgba(168, 213, 255, 0.2);
      --shadow: rgba(168, 213, 255, 0.15);
      --success: #10b981;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Animated background grid */
    .background-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(168, 213, 255, 0.08) 1px, transparent 1px),
        linear-gradient(90deg, rgba(168, 213, 255, 0.08) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes gridMove {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }

    /* Gradient orbs */
    .gradient-orb {
      position: fixed;
      border-radius: 50%;
      filter: blur(100px);
      opacity: 0.3;
      pointer-events: none;
      z-index: 1;
    }

    .orb-1 {
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, var(--purple-light), transparent);
      top: -200px;
      right: -200px;
      animation: float 20s ease-in-out infinite;
    }

    .orb-2 {
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, var(--pink-light), transparent);
      bottom: -150px;
      left: -150px;
      animation: float 25s ease-in-out infinite reverse;
    }

    .orb-3 {
      width: 450px;
      height: 450px;
      background: radial-gradient(circle, var(--blue-light), transparent);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: float 30s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(50px, 50px) scale(1.1); }
    }

    .container {
      position: relative;
      z-index: 10;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 40px;
      animation: fadeInDown 0.8s ease-out;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .logo-icon {
      font-size: 48px;
      filter: drop-shadow(0 4px 20px rgba(168, 213, 255, 0.4));
      animation: iconFloat 3s ease-in-out infinite;
    }

    @keyframes iconFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }

    h1 {
      font-family: 'Syne', sans-serif;
      font-size: clamp(32px, 5vw, 56px);
      font-weight: 800;
      background: linear-gradient(135deg, var(--blue-light) 0%, var(--purple-light) 25%, var(--pink-light) 50%, var(--coral) 75%, var(--yellow) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      letter-spacing: -0.02em;
      position: relative;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--purple-light), var(--pink-light), transparent);
      border-radius: 2px;
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 500;
    }

    /* Status indicator */
    .status-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 14px 28px;
      background: var(--bg-card);
      border: 2px solid transparent;
      background-image: 
        linear-gradient(white, white),
        linear-gradient(135deg, var(--blue-accent), var(--purple-accent), var(--pink-accent));
      background-origin: border-box;
      background-clip: padding-box, border-box;
      border-radius: 100px;
      margin: 0 auto 40px;
      max-width: fit-content;
      animation: fadeIn 1s ease-out 0.3s both;
      box-shadow: 0 8px 32px rgba(168, 213, 255, 0.2);
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 12px var(--success);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.2); }
    }

    .status-text {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .timer {
      font-family: 'Syne', monospace;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: 0.5px;
    }

    /* Chat container */
    .chat-container {
      flex: 1;
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 24px;
      padding: 32px;
      margin-bottom: 24px;
      min-height: 400px;
      max-height: 500px;
      overflow-y: auto;
      animation: slideUp 0.8s ease-out 0.5s both;
      position: relative;
      box-shadow: 
        0 20px 50px rgba(168, 213, 255, 0.1),
        0 4px 16px rgba(196, 181, 253, 0.08);
    }

    .chat-container::-webkit-scrollbar {
      width: 6px;
    }

    .chat-container::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-container::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--blue-accent), var(--purple-accent));
      border-radius: 3px;
    }

    .chat-container::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, var(--purple-light), var(--pink-light));
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: var(--text-secondary);
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    .empty-text {
      font-size: 15px;
      line-height: 1.6;
    }

    /* Message */
    .message {
      margin-bottom: 24px;
      animation: messageSlideIn 0.4s ease-out;
      display: flex;
      gap: 12px;
    }

    @keyframes messageSlideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
      margin-top: 4px;
    }

    .user-avatar {
      background: linear-gradient(135deg, var(--pink-light), var(--coral));
      box-shadow: 0 4px 12px rgba(240, 171, 252, 0.3);
    }

    .ai-avatar {
      background: linear-gradient(135deg, var(--blue-accent), var(--purple-accent));
      box-shadow: 0 4px 12px rgba(147, 197, 253, 0.3);
    }

    .message-content {
      flex: 1;
    }

    .message-header {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-secondary);
    }

    .message-text {
      font-size: 15px;
      line-height: 1.6;
      color: var(--text-primary);
      background: var(--bg-secondary);
      padding: 14px 18px;
      border-radius: 16px;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(168, 213, 255, 0.08);
    }

    /* Microphone button */
    .mic-container {
      display: flex;
      justify-content: center;
      margin-bottom: 24px;
      animation: fadeIn 1s ease-out 0.7s both;
    }

    .mic-button {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, var(--blue-light), var(--purple-light), var(--pink-light));
      color: white;
      font-size: 32px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      box-shadow: 
        0 10px 40px rgba(168, 213, 255, 0.4),
        0 4px 16px rgba(196, 181, 253, 0.3);
    }

    .mic-button::before {
      content: '';
      position: absolute;
      inset: -4px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--blue-light), var(--purple-light), var(--pink-light));
      opacity: 0;
      transition: opacity 0.3s;
      z-index: -1;
      filter: blur(20px);
    }

    .mic-button:hover {
      transform: scale(1.05);
      box-shadow: 
        0 15px 50px rgba(168, 213, 255, 0.5),
        0 6px 20px rgba(196, 181, 253, 0.4);
    }

    .mic-button:hover::before {
      opacity: 0.7;
    }

    .mic-button:active {
      transform: scale(0.95);
    }

    .mic-button.recording {
      animation: recordingPulse 1.5s ease-in-out infinite;
      background: linear-gradient(135deg, var(--pink-light), var(--coral), var(--yellow));
    }

    @keyframes recordingPulse {
      0%, 100% {
        box-shadow: 
          0 10px 40px rgba(240, 171, 252, 0.4),
          0 4px 16px rgba(252, 165, 165, 0.3),
          0 0 0 0 rgba(240, 171, 252, 0.7);
      }
      50% {
        box-shadow: 
          0 15px 50px rgba(240, 171, 252, 0.6),
          0 6px 20px rgba(252, 165, 165, 0.4),
          0 0 0 20px rgba(240, 171, 252, 0);
      }
    }

    /* Action buttons */
    .actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      animation: fadeIn 1s ease-out 0.9s both;
    }

    .action-btn {
      padding: 12px 24px;
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      box-shadow: 0 2px 8px rgba(168, 213, 255, 0.05);
    }

    .action-btn:hover {
      background: linear-gradient(135deg, rgba(168, 213, 255, 0.1), rgba(196, 181, 253, 0.1));
      border-color: var(--purple-accent);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(168, 213, 255, 0.2);
    }

    .action-btn:active {
      transform: translateY(0);
    }

    /* Message count badge */
    .message-count {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 6px 12px;
      background: linear-gradient(135deg, rgba(168, 213, 255, 0.15), rgba(196, 181, 253, 0.15));
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      backdrop-filter: blur(10px);
    }

    /* Animations */
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive */
    @media (max-width: 640px) {
      .container {
        padding: 20px 16px;
      }

      .chat-container {
        padding: 20px;
        margin-bottom: 20px;
      }

      .mic-button {
        width: 70px;
        height: 70px;
        font-size: 28px;
      }

      .action-btn {
        font-size: 13px;
        padding: 10px 18px;
      }
    }

    /* Sound wave decorations */
    .sound-waves {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      gap: 6px;
      align-items: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .mic-button.recording ~ .sound-waves {
      opacity: 1;
    }

    .wave-bar {
      width: 4px;
      background: linear-gradient(180deg, var(--pink-light), var(--coral));
      border-radius: 2px;
      animation: waveMotion 0.8s ease-in-out infinite;
    }

    .wave-bar:nth-child(1) { height: 20px; animation-delay: 0s; }
    .wave-bar:nth-child(2) { height: 30px; animation-delay: 0.1s; }
    .wave-bar:nth-child(3) { height: 40px; animation-delay: 0.2s; }
    .wave-bar:nth-child(4) { height: 30px; animation-delay: 0.3s; }
    .wave-bar:nth-child(5) { height: 20px; animation-delay: 0.4s; }

    @keyframes waveMotion {
      0%, 100% { transform: scaleY(0.5); }
      50% { transform: scaleY(1); }
    }

    /* Floating particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      opacity: 0.3;
      animation: particleFloat 20s linear infinite;
    }

    .particle:nth-child(1) {
      left: 10%;
      animation-delay: 0s;
      background: var(--blue-light);
    }

    .particle:nth-child(2) {
      left: 30%;
      animation-delay: 4s;
      background: var(--purple-light);
    }

    .particle:nth-child(3) {
      left: 50%;
      animation-delay: 8s;
      background: var(--pink-light);
    }

    .particle:nth-child(4) {
      left: 70%;
      animation-delay: 12s;
      background: var(--coral);
    }

    .particle:nth-child(5) {
      left: 90%;
      animation-delay: 16s;
      background: var(--yellow);
    }

    @keyframes particleFloat {
      0% {
        transform: translateY(100vh) scale(0);
        opacity: 0;
      }
      10% {
        opacity: 0.3;
      }
      90% {
        opacity: 0.3;
      }
      100% {
        transform: translateY(-100px) scale(1);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="particles">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>
  <div class="background-grid"></div>
  <div class="gradient-orb orb-1"></div>
  <div class="gradient-orb orb-2"></div>
  <div class="gradient-orb orb-3"></div>

  <div class="container">
    <div class="header">
      <div class="logo">
        <span class="logo-icon">üé§</span>
      </div>
      <h1>THE ENTITY</h1>
      <p class="subtitle">Powered by Voice AI Assistant </p>
    </div>

    <div class="status-bar">
      <div class="status-indicator"></div>
      <span class="status-text">Ready</span>
      <span class="timer" id="timer">--:--:--</span>
    </div>

    <div class="chat-container" id="chatContainer">
      <span class="message-count" id="messageCount">0 messages</span>
      <div class="empty-state">
        <div class="empty-icon">üí¨</div>
        <p class="empty-text">Click the microphone button to start speaking<br>Your conversation will appear here</p>
      </div>
    </div>

    <div class="mic-container">
      <button class="mic-button" id="micButton">
        üéôÔ∏è
      </button>
    </div>

    <div class="actions">
      <button class="action-btn" id="resetBtn">
        <span>üîÑ</span>
        <span>Reset Chat</span>
      </button>
      <button class="action-btn" id="clearBtn">
        <span>üóëÔ∏è</span>
        <span>Clear All</span>
      </button>
      <button class="action-btn" id="downloadBtn">
        <span>üíæ</span>
        <span>Download Chat</span>
      </button>
    </div>
  </div>

  <script>
    // State Management
    const state = {
        messages: [],
        isListening: false,
        isSpeaking: false,
        recognition: null,
        synthesis: window.speechSynthesis,
        messageCount: 0
    };

    // DOM Elements
    const elements = {
        chatContainer: document.getElementById('chatContainer'),
        micButton: document.getElementById('micButton'),
        statusBar: document.querySelector('.status-bar .status-text'),
        statusIndicator: document.querySelector('.status-indicator'),
        timer: document.getElementById('timer'),
        messageCount: document.getElementById('messageCount'),
        resetBtn: document.getElementById('resetBtn'),
        clearBtn: document.getElementById('clearBtn'),
        downloadBtn: document.getElementById('downloadBtn')
    };

    // Initialize Speech Recognition
    function initSpeechRecognition() {
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            state.recognition = new SpeechRecognition();
            state.recognition.continuous = false;
            state.recognition.interimResults = false;
            state.recognition.lang = 'en-US';

            state.recognition.onstart = () => {
                state.isListening = true;
                updateStatus('Listening...');
                elements.micButton.classList.add('recording');
            };

            state.recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                addMessage(transcript, true);
                processQuery(transcript);
            };

            state.recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                updateStatus('Ready');
                elements.micButton.classList.remove('recording');
            };

            state.recognition.onend = () => {
                state.isListening = false;
                elements.micButton.classList.remove('recording');
                if (!state.isSpeaking) {
                    updateStatus('Ready');
                }
            };
        } else {
            alert('Speech recognition is not supported in your browser. Please use Chrome or Edge.');
        }
    }

    // Update Status
    function updateStatus(text) {
        elements.statusBar.textContent = text;
    }

    // Add Message to Chat
    function addMessage(content, isUser = true) {
        // Remove empty state if exists
        const emptyState = elements.chatContainer.querySelector('.empty-state');
        if (emptyState) {
            emptyState.remove();
        }

        const message = {
            content,
            isUser,
            timestamp: new Date()
        };
        state.messages.push(message);
        state.messageCount++;

        const messageEl = document.createElement('div');
        messageEl.className = 'message';
        
        const avatar = isUser ? 'üë§' : 'ü§ñ';
        const senderName = isUser ? 'You' : 'AI Assistant';

        messageEl.innerHTML = `
            <div class="message-avatar ${isUser ? 'user-avatar' : 'ai-avatar'}">
                ${avatar}
            </div>
            <div class="message-content">
                <div class="message-header">${senderName}</div>
                <div class="message-text">${content}</div>
            </div>
        `;

        elements.chatContainer.appendChild(messageEl);
        elements.chatContainer.scrollTop = elements.chatContainer.scrollHeight;
        
        // Update message count
        elements.messageCount.textContent = `${state.messageCount} message${state.messageCount !== 1 ? 's' : ''}`;
        elements.messageCount.style.display = 'block';
    }

    // API Configuration
    const API_BASE_URL = 'http://127.0.0.1:8000';
    const SESSION_ID = 'web-ui-' + Date.now();

    // Process Query using FastAPI Backend
    async function processQuery(query) {
        updateStatus('Thinking...');

        try {
            const response = await fetch(`${API_BASE_URL}/api/query`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query: query,
                    session_id: SESSION_ID
                })
            });

            if (!response.ok) {
                throw new Error(`API error: ${response.status}`);
            }

            const data = await response.json();
            const assistantResponse = data.response;
            
            addMessage(assistantResponse, false);
            speakResponse(assistantResponse);

        } catch (error) {
            console.error('Error calling API:', error);
            const errorMessage = "Sorry, I'm having trouble connecting to the server. Please make sure the backend is running.";
            addMessage(errorMessage, false);
            speakResponse(errorMessage);
            updateStatus('Ready');
        }
    }

    // Speak Response
    function speakResponse(text) {
        if (state.synthesis) {
            updateStatus('Speaking...');
            state.isSpeaking = true;

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;

            utterance.onend = () => {
                state.isSpeaking = false;
                updateStatus('Ready');
            };

            state.synthesis.speak(utterance);
        }
    }

    // Microphone Button Click
    elements.micButton.addEventListener('click', () => {
        if (state.isListening) {
            state.recognition.stop();
        } else if (state.recognition) {
            state.recognition.start();
        }
    });

    // Reset Button
    elements.resetBtn.addEventListener('click', async () => {
        if (confirm('Are you sure you want to reset the conversation?')) {
            try {
                // Call API to reset conversation
                const response = await fetch(`${API_BASE_URL}/api/reset`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: SESSION_ID
                    })
                });

                if (response.ok) {
                    state.messages = [];
                    state.messageCount = 0;
                    elements.chatContainer.innerHTML = `
                        <span class="message-count" id="messageCount" style="display: none;">0 messages</span>
                        <div class="empty-state">
                            <div class="empty-icon">üí¨</div>
                            <p class="empty-text">Click the microphone button to start speaking<br>Your conversation will appear here</p>
                        </div>
                    `;
                    elements.messageCount = document.getElementById('messageCount');
                    elements.messageCount.textContent = '0 messages';
                    addMessage('Conversation history cleared. How can I help you?', false);
                }
            } catch (error) {
                console.error('Error resetting conversation:', error);
                alert('Failed to reset conversation. Please try again.');
            }
        }
    });

    // Clear Button
    elements.clearBtn.addEventListener('click', () => {
        if (confirm('Are you sure you want to clear all messages?')) {
            state.messages = [];
            state.messageCount = 0;
            elements.chatContainer.innerHTML = `
                <span class="message-count" id="messageCount" style="display: none;">0 messages</span>
                <div class="empty-state">
                    <div class="empty-icon">üí¨</div>
                    <p class="empty-text">Click the microphone button to start speaking<br>Your conversation will appear here</p>
                </div>
            `;
            elements.messageCount = document.getElementById('messageCount');
            elements.messageCount.textContent = '0 messages';
        }
    });

    // Download Button
    elements.downloadBtn.addEventListener('click', () => {
        if (state.messages.length === 0) {
            alert('No messages to download!');
            return;
        }

        let transcript = 'üé§ Voice AI Assistant - Chat Transcript\n';
        transcript += `Generated: ${new Date().toLocaleString()}\n`;
        transcript += '='.repeat(60) + '\n\n';

        state.messages.forEach(msg => {
            const time = msg.timestamp.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const sender = msg.isUser ? 'You' : 'Assistant';
            transcript += `[${time}] ${sender}:\n${msg.content}\n\n`;
        });

        const blob = new Blob([transcript], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `voice-assistant-chat-${Date.now()}.txt`;
        a.click();
        URL.revokeObjectURL(url);
    });

    // Update Time Display
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        elements.timer.textContent = timeString;
    }

    // Initialize
    initSpeechRecognition();
    updateTime();
    setInterval(updateTime, 1000);

    // Welcome Message
    setTimeout(() => {
        addMessage("Hello! I'm THE ENTITY. Click the microphone button and speak clearly to start our conversation.", false);
    }, 500);
  </script>
</body>
</html>